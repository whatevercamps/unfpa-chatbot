(this["webpackJsonpchatbot-web"]=this["webpackJsonpchatbot-web"]||[]).push([[0],{51:function(e,t,n){},52:function(e,t,n){},58:function(e,t,n){"use strict";n.r(t);var s=n(2),o=n(0),a=n.n(o),c=n(15),r=n.n(c),i=(n(50),n(51),n(52),n(25)),u=n(14),l=n(5),d=n(82),b=n(80),j=n(81),f=n(78),p=n(79),g=n(84),m=n(77),h=n(83),O=n(30),x=n.n(O),v=n(37),w=n.n(v);function y(e){var t=e.voiceNote,n=e.classes,a=e.recording,c=e.setRecording,r=e.setAudioMessage,i=e.sendAudioMessage,d=(Object(o.useRef)(),Object(o.useState)([])),b=Object(l.a)(d,2),j=b[0],f=b[1],p=Object(o.useState)(null),O=Object(l.a)(p,2),v=O[0],y=O[1],C=Object(o.useState)(!1),S=Object(l.a)(C,2),M=S[0],N=S[1],k=Object(o.useState)(0),E=Object(l.a)(k,2),q=E[0],A=E[1],T=Object(o.useState)(0),R=Object(l.a)(T,2),I=R[0],P=R[1],F=Object(o.useState)(0),B=Object(l.a)(F,2),D=B[0],G=B[1],_=Object(o.useState)(null),J=Object(l.a)(_,2),L=J[0],U=J[1];Object(o.useEffect)((function(){a?U(setInterval((function(){A((function(e){return e+1}))}),1e3)):L&&(clearInterval(L),U(null))}),[a]),Object(o.useEffect)((function(){M&&(N(!1),z())}),[v]),Object(o.useEffect)((function(){q?(P(Math.floor(q/60)),G(Math.floor(q%60))):(P(0),G(0))}),[q]);var z=function(){v?(c(!0),v.start(100)):(N(!0),navigator.mediaDevices.getUserMedia({audio:!0}).then((function(e){var t=new MediaRecorder(e);t.ondataavailable=function(e){f((function(t){return[].concat(Object(u.a)(t),[e.data])}))},y(t)})))};return t?Object(s.jsxs)(s.Fragment,{children:[(a||j.length>0)&&Object(s.jsxs)("div",{className:"text-center centerText",children:[a&&Object(s.jsx)(g.a,{className:n.input,value:"Escuchando \ud83d\udc42\ud83c\udffb ".concat(I/10<1?"0":"").concat(I,":").concat(D/10<1?"0":"").concat(D),disabled:!0,inputProps:{"aria-label":"jeje"}}),!a&&j.length>0&&Object(s.jsx)(g.a,{className:n.input,value:"Env\xedamos tu audio? \ud83e\udd13  ".concat(I/10<1?"0":"").concat(I,":").concat(D/10<1?"0":"").concat(D),disabled:!0,inputProps:{"aria-label":"jeje"}})]}),(a||j.length>0)&&Object(s.jsx)(m.a,{className:n.divider,orientation:"vertical"}),Object(s.jsx)(h.a,{className:n.iconButton,"aria-label":"directions",onClick:a?function(){v&&(v.stop(),r(j),c(!1))}:j.length>0?function(){if(!a&&j.length){var e=new Blob(j,{type:"audio/webm"}),t=new window.FileReader;t.readAsDataURL(e),t.onloadend=function(){var e=t.result;i({type:"audio/webm",data:e.split(",")[1]})}}}:z,children:a||0===j.length?Object(s.jsx)(w.a,{style:a?{color:"hsl(346,76%,95%)"}:{color:"hsl(346,76%,77%)"}}):Object(s.jsx)(x.a,{style:{color:"hsl(346,76%,77%)"}})})]}):Object(s.jsx)("div",{className:"VoiceRecorder"})}var C=Object(f.a)((function(e){return{root:{padding:"2px 4px",display:"flex",alignItems:"center",width:"100%"},input:{marginLeft:e.spacing(1),flex:1},iconButton:{padding:10},divider:{height:28,margin:4}}}));function S(e){var t=Object(o.useState)(""),n=Object(l.a)(t,2),a=n[0],c=n[1],r=Object(o.useState)(!1),i=Object(l.a)(r,2),u=i[0],d=i[1],b=Object(o.useState)(null),j=Object(l.a)(b,2),f=j[0],O=j[1],v=C();return Object(s.jsxs)(p.a,{component:"form",className:v.root,onSubmit:function(t){a.split("").length&&(t.preventDefault(),e.finish(a))},children:[!u&&!f&&Object(s.jsx)(g.a,{className:v.input,onChange:function(e){return c(e.target.value)},value:a,placeholder:e.input.placeholder,inputProps:{"aria-label":e.input.placeholder}}),!u&&!f&&Object(s.jsx)(m.a,{className:v.divider,orientation:"vertical"}),0!==a.length||e.input.notAllowedToRecord?Object(s.jsx)(h.a,{disabled:a.split("").length<=0,type:"submit",className:v.iconButton,"aria-label":"directions",children:Object(s.jsx)(x.a,{style:a.split("").length>0?{color:"hsl(346,76%,77%)"}:{color:"hsl(346,76%,95%)"}})}):Object(s.jsx)(y,{voiceNote:!0,classes:v,recording:u,setRecording:d,setAudioMessage:O,sendAudioMessage:e.finish})]})}function M(e,t){t.setMessageInput;return Object(s.jsx)("div",{onClick:e.customClickEvent?function(){return e.customClickEvent()}:function(){return!0},className:("bot"===e.message.sender?"Message bot scale-up-tl":"Message user scale-up-tr")+(e.nextMessage&&e.nextMessage.sender===e.message.sender?"":" final")+(e.customClickEvent?" clickable":""),children:e.message.text||e.message.input&&Object(s.jsx)(S,{input:e.message.input,finish:function(t){e.message.input.handleSubmit(t)}})})}function N(e){return Object(s.jsx)("div",{className:"OptionsMessage",children:Object(s.jsx)(b.a,{children:e.options.map((function(t,n){return Object(s.jsx)(j.a,{lg:Math.round(12/(e.options.length||1)),children:Object(s.jsx)(M,{customClickEvent:t.onClick,message:t.message,nextMessage:e.nextMessage})},n)}))})})}function k(){var e=Object(o.useRef)(),t=Object(o.useState)(null),n=Object(l.a)(t,2),a=n[0],c=n[1],r=Object(o.useState)(null),f=Object(l.a)(r,2),p=f[0],g=f[1],m=Object(o.useState)(null),h=Object(l.a)(m,2),O=h[0],x=h[1],v=Object(o.useState)(null),w=Object(l.a)(v,2),y=w[0],C=w[1],S=Object(o.useState)([]),k=Object(l.a)(S,2),E=k[0],q=k[1],A=function(e,t){console.log("session = ",e),console.log("w message",t);var n={message:t,userName:O,userAgeMin:a[0],userAgeMax:a[1],userGender:p};console.log("payload",n,JSON.stringify(n)),fetch("/api/watson/message",{method:"POST",headers:{session_id:e,Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(n)}).then((function(e){if(200===e.status)return e.json();throw new Error("failed getting watson api response")})).then((function(e){if(!(e&&e.output&&e.output.generic&&e.output.generic.length))throw new Error("failed getting watson message response");var t=[].concat(Object(u.a)(e.output.generic.map((function(e){return{sender:"bot",text:e.text}}))),[{sender:"user",input:{handleSubmit:T,placeholder:"ingresa aqu\xed tu respuesta"}}]);I(t)})).catch((function(e){return console.log("login error",e),!1}))},T=function(e){console.log("message",e),q((function(t){var n=t.pop();return n=[].concat(Object(u.a)(t),[Object(i.a)(Object(i.a)({},n),{},{text:e.type&&"audio/webm"===e.type?"Nota de voz \ud83d\udd08":e})]),console.log("mss",n),n})),y?A(y,e):R().then((function(t){console.log("obtuve un nuevo promise sId",t),A(t,e)})).catch((function(e){return console.log("error",e)}))},R=function(){return new Promise((function(e,t){fetch("/api/watson/session",{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}}).then((function(e){if(200===e.status)return e.json();throw new Error("failed getting watson api response")})).then((function(t){if(!t||!t.session_id)throw new Error("failed getting watson session id");C(t.session_id),console.log("sesssion creada",t.session_id),e(t.session_id)})).catch((function(e){console.log("login error",e),t(!1)}))}))},I=function e(t,n){setTimeout((function(){var n=Object(u.a)(t);if(n&&n.length){var s=n.shift();return s&&q((function(e){return[].concat(Object(u.a)(e),[s])})),e(n)}return!0}),n||1e3+Math.floor(500*Math.random()+300))};return Object(o.useEffect)((function(){e&&e.current.scrollIntoView({behavior:"smooth"})}),[e,E]),Object(o.useEffect)((function(){a&&a.length&&function(e,t,n){e([{sender:"bot",text:t[1]<=18?"Ah, eres bastante joven... genial!":"Genial!"},{sender:"bot",text:"\ud83e\udd13 sigamos! "},{sender:"bot",text:"Obviamente todos somos \xfanicos \ud83d\udc96... pero en este caso necesito saber si te consideras hombre, mujer, o de otro g\xe9nero..."},{sender:"user",options:[{message:{sender:"user",text:"hombre \ud83e\udddd\ud83c\udffc"},onClick:function(){return n("hombre")}},{message:{sender:"user",text:"mujer \ud83e\udddd\ud83c\udffb\u200d\u2640\ufe0f"},onClick:function(){return n("mujer")}},{message:{sender:"user",text:"nah, las etiquetas no son lo m\xedo \ud83e\udddd\ud83c\udffb\u200d\u2642\ufe0f"},onClick:function(){return n("otro")}}]}],50)}(I,a,(function(e){g(e)}))}),[a]),Object(o.useEffect)((function(){a&&a.length&&p&&function(e,t,n,s){var o=[{sender:"bot",text:"Oye, \xbfy te gustar\xeda que te llame de alguna manera o lo dejamos as\xed?"},{sender:"user",options:[{message:{sender:"user",text:"See \ud83d\ude0e"},onClick:function(){return e([{sender:"bot",text:"Genial! Dime, \xbfc\xf3mo quieres que te llame durante nuestra charla?"},{sender:"user",input:{notAllowedToRecord:!0,handleSubmit:s,placeholder:"pon aqu\xed tu nombre"}}])}},{message:{sender:"user",text:"Nah \ud83d\ude05"},onClick:function(){return s()}}]}];e(o,50)}(I,0,0,(function(e){e?(q((function(t){var n=t.pop();return n=[].concat(Object(u.a)(t),[Object(i.a)(Object(i.a)({},n),{},{text:e})]),console.log("mss",n),n})),x(", ".concat(e,","))):x(",")}))}),[p]),Object(o.useEffect)((function(){a&&a.length&&p&&O&&function(e,t,n,s,o){e([{sender:"bot",text:"Ahora si ".concat(s," \xa1empecemos a divertirnos!")},{sender:"bot",text:"Cu\xe9ntame, \xbfen qu\xe9 puedo ayudarte?"},{sender:"user",input:{handleSubmit:o,placeholder:"puedes contarme lo que sea"}}],50)}(I,0,0,O,T)}),[O]),Object(o.useEffect)((function(){!function(e,t,n){t([]);var s=[{sender:"bot",text:"Hola, soy C418 \ud83e\udd16."},{sender:"bot",text:"Me crearon para atender las necesidades que puedieras tener acerca de pr\xe1cticamente cualquier cosa relacionada a UNFPA."},{sender:"user",options:[{onClick:function(){return e([{sender:"bot",text:"Claro, me crearon en el grupo de Innovaci\xf3n del UNFPA. Todos ellos buscan que pueda incentivar la opini\xf3n colectiva de los j\xf3venes al rededor de la innovaci\xf3n y, a la vez, proteger los derechos de las mujeres, hombres, y ni\xf1os que lo necesiten."},{sender:"user",options:[{onClick:function(){return e([{sender:"bot",text:"Gracias! Antes de empezar debes saber que Esta conversaci\xf3n es confidencial, no recogo ning\xfan dato personal sobre ti."},{sender:"user",options:[{onClick:function(){return e([{sender:"bot",text:"Bueno, empecemos por saber tu edad."},{sender:"bot",text:"Te prometo que ya casi terminamos la parte aburrida, pero necesito saber algunas cosas que me permitir\xe1n saber m\xe1s de lo que quieres \ud83e\udd13"},{sender:"user",options:[{message:{sender:"user",text:"soy menor de edad \ud83d\udc7c\ud83c\udffb"},onClick:function(){n([0,18])}},{message:{sender:"user",text:"soy menor de 25 \ud83d\udc81\ud83c\udffb"},onClick:function(){n([18,25])}},{message:{sender:"user",text:"soy mayor de 25 \ud83d\udc68\ud83c\udffb\u200d\u2696\ufe0f"},onClick:function(){n([25,99])}}]}],500)},message:{sender:"user",text:"Qu\xe9 bueno saberlo \ud83d\udc96"}}]}],500)},message:{sender:"user",text:"Suena genial!"}}]}],500)},message:{sender:"user",text:"Okey, cu\xe9ntame m\xe1s! \ud83d\udc40"}}]}];e(s,50)}(I,q,(function(e){c(e)}))}),[]),Object(s.jsxs)(d.a,{className:"Conversation",children:[E&&E.length&&E.map((function(e,t){return Object(s.jsx)(b.a,{children:Object(s.jsx)(j.a,{xs:"bot"===e.sender?9:{offset:1,span:9},sm:"bot"===e.sender?6:e.options&&e.options.length>=4?{offset:4,span:8}:e.options&&e.options.length>=2?{offset:6,span:6}:{offset:8,span:4},children:e.options?Object(s.jsx)(N,{options:e.options,nextMessage:E[t+1]}):Object(s.jsx)(M,{message:e,nextMessage:E[t+1]})})},t)})),Object(s.jsx)("div",{ref:e})]})}var E=function(){return Object(s.jsx)("div",{className:"App",children:Object(s.jsx)(k,{})})},q=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,86)).then((function(t){var n=t.getCLS,s=t.getFID,o=t.getFCP,a=t.getLCP,c=t.getTTFB;n(e),s(e),o(e),a(e),c(e)}))};r.a.render(Object(s.jsx)(a.a.StrictMode,{children:Object(s.jsx)(E,{})}),document.getElementById("root")),q()}},[[58,1,2]]]);
//# sourceMappingURL=main.2ce7b998.chunk.js.map